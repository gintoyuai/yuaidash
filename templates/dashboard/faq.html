{% extends "dashboard/mainbase.html" %}
{% load static %}

{% block content %}
<!-- MAIN CONTENT -->
<div class="main-content">
    <!-- HEADER -->
    <div class="header">
        <div class="header-left">
            <div class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            
        </div>

        <div class="header-right">
            <div class="header-action">
                <i class="far fa-bell"></i>
                <span class="notification-badge">3</span>
            </div>
            <div class="header-action">
                <i class="far fa-envelope"></i>
                <span class="notification-badge">5</span>
            </div>
            <div class="user-profile">
                <div class="user-avatar">A</div>
                <div class="user-info">
                    <div class="user-name">Admin User</div>
                    <div class="user-role">Administrator</div>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTENT AREA -->
    <div class="content">
        <div class="content-header">
            <h1>FAQ Management</h1>
            <div class="breadcrumb">
                <a href="#">Home</a> <i class="fas fa-chevron-right" style="font-size: 10px;"></i>
                <span>FAQ</span>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-question-circle"></i>
                </div>
                <div class="stat-number">{{ total_faq }}</div>
                <div class="stat-label">Total FAQs</div>
            </div>
        </div>

        <!-- FAQ Header with Add Button -->
        <div class="faq-header">
            <h2>Frequently Asked Questions</h2>
            <a href="{% url 'add_faq' %}" class="btn-primary">
                <i class="fas fa-plus"></i> Add New FAQ
            </a>
        </div>



        <!-- FAQ List -->
        <div class="faq-list">
            {% for faq in page_obj %}
            <div class="faq-item">
                <div class="faq-question">
                    <div>
                        <h3>{{ faq.question }}</h3>
                        <span class="faq-status status-{{ faq.status }}">{{ faq.status|title }}</span>
                    </div>
                    <div class="faq-toggle"><i class="fas fa-chevron-down"></i></div>
                </div>
                <div class="faq-answer">
                    <p>{{ faq.answer }}</p>
                    <span class="faq-meta"><strong>Added on</strong> {{ faq.datetime }}</span>
                    <span class="faq-meta"><strong>Email</strong> {{ faq.email_id }}</span>
                    <div class="faq-actions">
                        <a href="{% url 'edit_faq' faq.id %}" class="faq-action-btn"><i class="fas fa-edit"></i>
                            Edit</a>
                        <a href="javascript:void(0);" onclick="openModal('{{ faq.id }}')"
                            class="faq-action-btn btn-delete">
                            <i class="fas fa-trash-alt"></i> Delete
                        </a>
                    </div>
                </div>
            </div>

            <!-- Delete Confirmation Modal -->
            <div id="deleteModal{{ faq.id }}" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModal('{{ faq.id }}')">&times;</span>
                    <h3>Confirm Delete</h3>
                    <p>Are you sure you want to delete this FAQ?</p>
                    <div class="actions">
                        <button class="cancel" onclick="closeModal('{{ faq.id }}')">Cancel</button>
                        <form action="{% url 'delete_faq' faq.id %}" method="POST" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="delete">Delete</button>
                        </form>
                    </div>
                </div>
            </div>


            {% empty %}
            <div class="no-results">
                <p>No FAQs found matching your criteria.</p>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        <div class="pagination">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                class="page-link">&laquo;</a>
            {% else %}
            <span class="page-link">&laquo;</span>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
            {% if num == page_obj.number %}
            <span class="current-page">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %} <a
                href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                class="page-link">{{ num }}</a>
                {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                    class="page-link">&raquo;</a>
                {% else %}
                <span class="page-link">&raquo;</span>
                {% endif %}
        </div>
    </div>
</div>

<!-- Modal CSS -->
<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        width: 320px;
        text-align: center;
        position: relative;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .close {
        position: absolute;
        right: 10px;
        top: 10px;
        font-size: 20px;
        cursor: pointer;
    }

    .actions {
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
    }

    button.cancel {
        background: #ccc;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
    }

    button.delete {
        background: #e74c3c;
        color: #fff;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
    }

    button.cancel:hover {
        background: #bbb;
    }

    button.delete:hover {
        background: #c0392b;
    }
</style>

<!-- Modal JS -->
<script>
    function openModal(id) {
        document.getElementById('deleteModal' + id).style.display = 'flex';
    }
    function closeModal(id) {
        document.getElementById('deleteModal' + id).style.display = 'none';
    }
    window.onclick = function (event) {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            if (event.target === modal) modal.style.display = 'none';
        });
    };
</script>



<script>
    // FAQ toggle functionality
    document.querySelectorAll('.faq-question').forEach(question => {
        question.addEventListener('click', () => {
            const answer = question.nextElementSibling;
            const toggleIcon = question.querySelector('.faq-toggle i');

            answer.classList.toggle('active');

            if (answer.classList.contains('active')) {
                toggleIcon.className = 'fas fa-chevron-up';
            } else {
                toggleIcon.className = 'fas fa-chevron-down';
            }
        });
    });

    // Global search functionality
    document.getElementById('global-search').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            const searchTerm = this.value;
            if (searchTerm.trim()) {
                window.location.href = ``;
            }
        }
    });

    // Auto-submit form when filters change
    document.getElementById('status-filter').addEventListener('change', function () {
        document.getElementById('filter-form').submit();
    });

    document.getElementById('sort-by').addEventListener('change', function () {
        document.getElementById('filter-form').submit();
    });

    // Real-time search in filter section
    document.getElementById('search').addEventListener('input', function () {
        // Optional: Add debounce for better performance
        clearTimeout(this.searchTimeout);
        this.searchTimeout = setTimeout(() => {
            document.getElementById('filter-form').submit();
        }, 500);
    });
</script>

<style>
    .faq-filters {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        align-items: end;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .filter-group label {
        font-size: 12px;
        font-weight: 600;
        color: #555;
    }

    .filter-group select,
    .filter-group input {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }

    .btn-filter {
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        height: fit-content;
    }

    .btn-clear {
        background: #6c757d;
        color: white;
        padding: 8px 16px;
        border-radius: 4px;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        height: fit-content;
    }

    .btn-filter:hover {
        background: #0056b3;
    }

    .btn-clear:hover {
        background: #545b62;
        color: white;
    }

    .no-results {
        text-align: center;
        padding: 40px;
        color: #666;
        background: #f8f9fa;
        border-radius: 8px;
    }

    .faq-status {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        color: white;
    }

    .status-published {
        background: #28a745;
    }

    .status-draft {
        background: #ffc107;
        color: #000;
    }

    .faq-category {
        background: #e3f2fd;
        color: #1976d2;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        margin-right: 8px;
    }
</style>
{% endblock %}