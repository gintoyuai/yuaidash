{% extends "dashboard/mainbase.html" %}
{% load static %}

{% block content %}
<style>
    .blog-management {
        display: flex;
        flex-direction: column;
        gap: 30px;
    }
    .blog-form-container {
        background: #fff;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        margin-bottom: 30px;
    }
    .form-section {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
    }
    .form-section-title {
        font-size: 18px;
        color: #333;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #4a6cf7;
        display: inline-block;
    }
    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    .form-group {
        flex: 1;
    }
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
    }
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 15px;
        transition: border-color 0.3s;
    }
    .form-control:focus {
        border-color: #4a6cf7;
        outline: none;
    }
    textarea.form-control {
        min-height: 120px;
        resize: vertical;
    }
    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        margin-top: 20px;
    }
    .btn {
        padding: 12px 25px;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }
    .btn-primary {
        background: #4a6cf7;
        color: #fff;
        border: none;
    }
    .btn-primary:hover {
        background: #3b5be3;
    }
    .btn-secondary {
        background: #f8f9fa;
        color: #333;
        border: 1px solid #ddd;
    }
    .btn-secondary:hover {
        background: #e9ecef;
    }
    .btn-danger {
        background: #dc3545;
        color: #fff;
        border: none;
    }
    .btn-danger:hover {
        background: #bb2d3b;
    }
    .image-preview {
        margin-top: 15px;
        text-align: center;
    }
    .image-preview img {
        max-width: 200px;
        max-height: 150px;
        border-radius: 8px;
        border: 1px solid #ddd;
    }
    
    /* Existing Images Section */
    .existing-images {
        margin-top: 20px;
    }
    .existing-images-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }
    .existing-image-item {
        position: relative;
        border: 1px solid #eee;
        border-radius: 8px;
        overflow: hidden;
    }
    .existing-image-item img {
        width: 100%;
        height: 120px;
        object-fit: cover;
    }
    .existing-image-actions {
        position: absolute;
        top: 5px;
        right: 5px;
        display: flex;
        gap: 5px;
    }
    .existing-image-actions button {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 12px;
    }
    .delete-image-btn {
        background: rgba(220, 53, 69, 0.8);
        color: white;
    }
    
    /* Additional Images Section */
    .image-upload-item {
        border: 1px dashed #ddd;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }
    .remove-image {
        margin-top: 10px;
        background: #ffe8e8;
        color: #dc3545;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
    }
    
    /* Status indicators */
    .status-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 10px;
    }
    .status-published {
        background: #e8f5e9;
        color: #2e7d32;
    }
    .status-draft {
        background: #fff3e0;
        color: #ef6c00;
    }
</style>

<!-- MAIN CONTENT -->
<div class="main-content">
    <!-- HEADER -->
    <div class="header">
        <div class="header-left">
            <div class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search blogs...">
            </div>
        </div>

        <div class="header-right">
            <div class="header-action">
                <i class="far fa-bell"></i>
                <span class="notification-badge">3</span>
            </div>
            <div class="header-action">
                <i class="far fa-envelope"></i>
                <span class="notification-badge">5</span>
            </div>
            <div class="user-profile">
                <div class="user-avatar">A</div>
                <div class="user-info">
                    <div class="user-name">Admin User</div>
                    <div class="user-role">Administrator</div>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTENT AREA -->
    <div class="content">
        <div class="content-header">
            <h1>Edit Blog Post <span class="status-badge status-published">Published</span></h1>
            <div class="breadcrumb">
                <a href="#">Home</a> <i class="fas fa-chevron-right" style="font-size: 10px;"></i>
                <a href="{% url 'blog' %}">Blogs</a> <i class="fas fa-chevron-right" style="font-size: 10px;"></i>
                <a href="{% url 'blog' %}">Manage Blogs</a> <i class="fas fa-chevron-right" style="font-size: 10px;"></i>
                <span>Edit Blog</span>
            </div>
        </div>

        <div class="blog-management">
            <!-- Edit Blog Form -->
            <div class="blog-form-container">
                <h2>Edit Blog Post: "The Future of Web Development"</h2>
                
                <form method="POST" enctype="multipart/form-data" id="blogForm">
                    {% csrf_token %}
                    
                    <!-- Basic Information Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Basic Information</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="name">Author Name *</label>
                                <input type="text" id="name" name="name" class="form-control" value="John Doe" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="designation">Designation</label>
                                <input type="text" id="designation" name="designation" class="form-control" value="Senior Web Developer">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="subject">Blog Subject *</label>
                                <input type="text" id="subject" name="subject" class="form-control" value="The Future of Web Development" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-group">
                                    <input type="checkbox" id="featured" name="featured" checked>
                                    <span>Featured Blog Post</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="description">Blog Content *</label>
                            <textarea id="description" name="description" class="form-control" required>Exploring the latest trends and technologies that are shaping the future of web development and how they will impact businesses. In recent years, we've seen significant advancements in frameworks, tools, and methodologies that are transforming how we build for the web.</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="blog_quotes">Quotes (Optional)</label>
                            <textarea id="blog_quotes" name="blog_quotes" class="form-control">"The web is becoming increasingly intelligent and responsive, creating more immersive user experiences than ever before." - Web Development Expert</textarea>
                        </div>
                    </div>
                    
                    <!-- Media Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Media</h3>
                        
                        <div class="form-group">
                            <label for="image">Featured Image</label>
                            <input type="file" id="image" name="image" class="form-control" accept="image/*">
                            <div class="image-preview" id="image-preview">
                                <img src="https://via.placeholder.com/300x180" alt="Current featured image">
                                <p class="image-note">Current featured image</p>
                            </div>
                        </div>
                        
                        <!-- Existing Images -->
                        <div class="existing-images">
                            <label>Existing Additional Images</label>
                            <div class="existing-images-grid">
                                <div class="existing-image-item">
                                    <img src="https://via.placeholder.com/150x120" alt="Additional image 1">
                                    <div class="existing-image-actions">
                                        <button class="delete-image-btn" title="Delete image">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="existing-image-item">
                                    <img src="https://via.placeholder.com/150x120" alt="Additional image 2">
                                    <div class="existing-image-actions">
                                        <button class="delete-image-btn" title="Delete image">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Add More Images</label>
                            <div id="additional-images-container">
                                <div class="image-upload-item">
                                    <input type="file" name="blog_images" class="form-control" accept="image/*">
                                    <div class="image-preview"></div>
                                    <button type="button" class="remove-image" style="display: none;">
                                        <i class="fas fa-times"></i> Remove
                                    </button>
                                </div>
                            </div>
                            <button type="button" id="add-image" class="btn btn-secondary" style="margin-top: 15px;">
                                <i class="fas fa-plus"></i> Add Another Image
                            </button>
                        </div>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Delete Post
                        </button>
                        <button type="button" class="btn btn-secondary">
                            Save as Draft
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Update Blog
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Image preview functionality for featured image
    document.getElementById('image').addEventListener('change', function(e) {
        const preview = document.getElementById('image-preview');
        
        if (this.files && this.files[0]) {
            preview.innerHTML = '';
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                preview.appendChild(img);
                
                const note = document.createElement('p');
                note.className = 'image-note';
                note.textContent = 'New image preview';
                preview.appendChild(note);
            }
            reader.readAsDataURL(this.files[0]);
        }
    });
    
    // Additional images functionality
    let imageCount = 1;
    
    document.getElementById('add-image').addEventListener('click', function() {
        imageCount++;
        
        const container = document.getElementById('additional-images-container');
        const newImageItem = document.createElement('div');
        newImageItem.className = 'image-upload-item';
        newImageItem.innerHTML = `
            <input type="file" name="blog_images" class="form-control" accept="image/*">
            <div class="image-preview"></div>
            <button type="button" class="remove-image">
                <i class="fas fa-times"></i> Remove
            </button>
        `;
        
        container.appendChild(newImageItem);
        
        // Add event listener for the new remove button
        newImageItem.querySelector('.remove-image').addEventListener('click', function() {
            this.closest('.image-upload-item').remove();
        });
        
        // Add event listener for the new image preview
        newImageItem.querySelector('input[type="file"]').addEventListener('change', function(e) {
            const preview = this.nextElementSibling;
            preview.innerHTML = '';
            
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    preview.appendChild(img);
                }
                reader.readAsDataURL(this.files[0]);
            }
        });
    });
    
    // Add event listeners to initial remove buttons
    document.querySelectorAll('.remove-image').forEach(button => {
        button.addEventListener('click', function() {
            this.closest('.image-upload-item').remove();
        });
    });
    
    // Add event listeners to delete existing image buttons
    document.querySelectorAll('.delete-image-btn').forEach(button => {
        button.addEventListener('click', function() {
            const confirmDelete = confirm('Are you sure you want to delete this image?');
            if (confirmDelete) {
                this.closest('.existing-image-item').remove();
            }
        });
    });
    
    // Form validation
    document.getElementById('blogForm').addEventListener('submit', function(e) {
        const name = document.getElementById('name').value.trim();
        const subject = document.getElementById('subject').value.trim();
        const description = document.getElementById('description').value.trim();
        
        if (!name) {
            e.preventDefault();
            alert('Please enter author name.');
            document.getElementById('name').focus();
            return;
        }
        
        if (!subject) {
            e.preventDefault();
            alert('Please enter blog subject.');
            document.getElementById('subject').focus();
            return;
        }
        
        if (!description) {
            e.preventDefault();
            alert('Please enter blog content.');
            document.getElementById('description').focus();
            return;
        }
    });
    
    // Delete post confirmation
    document.querySelector('.btn-danger').addEventListener('click', function() {
        const confirmDelete = confirm('Are you sure you want to delete this blog post? This action cannot be undone.');
        if (confirmDelete) {
            // In a real application, this would trigger a delete request
            alert('Blog post deleted. Redirecting to blog management...');
            window.location.href = "{% url 'blog' %}";
        }
    });
</script>

{% endblock %}